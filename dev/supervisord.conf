[supervisord]
nodaemon=true
user=brain
# Use /tmp for logs to ensure compatibility with Apptainer
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/tmp/
# Suppress some logging to reduce file I/O issues
silent=false
loglevel=info

[program:xvfb]
command=/usr/bin/Xvfb :1 -screen 0 1920x1080x24
autorestart=true
priority=100
stdout_logfile=/tmp/xvfb_stdout.log
stderr_logfile=/tmp/xvfb_stderr.log
# Reduce log rotation to minimize file operations
stdout_logfile_maxbytes=1MB
stderr_logfile_maxbytes=1MB
stdout_logfile_backups=1
stderr_logfile_backups=1

[program:x11vnc]
command=/usr/bin/x11vnc -display :1 -xkb -forever -shared -rfbauth /home/brain/.vnc/passwd -repeat
autorestart=true
priority=200
stdout_logfile=/tmp/x11vnc_stdout.log
stderr_logfile=/tmp/x11vnc_stderr.log
stdout_logfile_maxbytes=1MB
stderr_logfile_maxbytes=1MB
stdout_logfile_backups=1
stderr_logfile_backups=1

[program:xfce4-session]
command=/usr/bin/startxfce4
environment=DISPLAY=:1,HOME=/home/brain
autorestart=true
priority=300
stdout_logfile=/tmp/xfce4_stdout.log
stderr_logfile=/tmp/xfce4_stderr.log
stdout_logfile_maxbytes=1MB
stderr_logfile_maxbytes=1MB
stdout_logfile_backups=1
stderr_logfile_backups=1

[program:novnc]
command=/usr/share/novnc/utils/launch.sh --vnc localhost:5900 --listen 0.0.0.0:6080
autorestart=true
priority=400
stdout_logfile=/tmp/novnc_stdout.log
stderr_logfile=/tmp/novnc_stderr.log
stdout_logfile_maxbytes=1MB
stderr_logfile_maxbytes=1MB
stdout_logfile_backups=1
stderr_logfile_backups=1
